<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√în T·∫≠p CSTH - Full 300 v10</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --grad-1: #7289da; --grad-2: #00d2ff; --accent: #00d2ff;
            --border-light: rgba(255, 255, 255, 0.12);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { height: 100vh; width: 100vw; display: flex; justify-content: center; align-items: center; overflow: hidden; color: white; background: #000; }
        #bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; filter: brightness(0.55); }

        .quiz-container {
            width: 94%; max-width: 440px; height: auto; max-height: 92vh;
            display: flex; flex-direction: column;
            background: linear-gradient(180deg, rgba(30, 32, 45, 0.85) 0%, rgba(20, 22, 30, 0.7) 100%);
            backdrop-filter: blur(50px) saturate(180%); -webkit-backdrop-filter: blur(50px) saturate(180%);
            border: 1px solid var(--border-light); border-top: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 32px; padding: 24px;
            box-shadow: 0 40px 80px -10px rgba(0,0,0,0.8);
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .header { display: flex; flex-direction: column; align-items: center; margin-bottom: 15px; flex-shrink: 0; }
        .avatar-glow { position: absolute; width: 80px; height: 80px; background: radial-gradient(circle, var(--grad-1), transparent 70%); opacity: 0.8; filter: blur(15px); }
        .avatar { width: 72px; height: 72px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.9); object-fit: cover; position: relative; z-index: 2; margin-bottom: 10px; }
        .stats-bar { display: flex; gap: 12px; font-size: 13px; font-weight: 600; background: rgba(0,0,0,0.4); padding: 6px 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 12px; }
        .controls { display: flex; gap: 8px; justify-content: center; width: 100%; }
        .icon-btn { width: 40px; height: 40px; border-radius: 12px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        select { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.15); color: white; padding: 0 12px; border-radius: 12px; height: 40px; outline: none; font-size: 13px; font-weight: 500; flex-grow: 1; max-width: 160px; }

        .content-area { overflow-y: auto; padding: 2px; flex-grow: 1; scrollbar-width: none; display: flex; flex-direction: column; }
        .question-box { background: rgba(255, 255, 255, 0.03); border-left: 3px solid var(--accent); padding: 16px; margin-bottom: 20px; border-radius: 0 16px 16px 0; }
        .q-category { color: var(--accent); font-size: 11px; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 6px; display: block; }
        .question-text { font-size: 16px; font-weight: 600; line-height: 1.5; text-shadow: 0 2px 4px rgba(0,0,0,0.6); }

        .options-grid { display: flex; flex-direction: column; gap: 10px; }
        .option-btn { width: 100%; position: relative; background: rgba(255, 255, 255, 0.06); border: 1px solid rgba(255, 255, 255, 0.1); padding: 16px 18px; border-radius: 18px; color: rgba(255,255,255,0.95); text-align: left; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; align-items: flex-start; transition: all 0.2s; }
        .option-btn:active { transform: scale(0.98); background: rgba(255,255,255,0.12); }
        .tag { min-width: 26px; height: 26px; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; margin-right: 14px; margin-top: -2px; color: var(--accent); }
        .option-btn.correct { background: rgba(46, 204, 113, 0.25) !important; border-color: #2ecc71 !important; box-shadow: 0 0 20px rgba(46, 204, 113, 0.2); }
        .option-btn.wrong { background: rgba(231, 76, 60, 0.25) !important; border-color: #e74c3c !important; opacity: 0.6; }

        .next-btn { width: 100%; margin-top: 25px; margin-bottom: 10px; background: linear-gradient(135deg, var(--grad-1), var(--grad-2)); border: none; padding: 16px; border-radius: 18px; color: white; font-weight: 700; font-size: 15px; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .particle { position: absolute; pointer-events: none; border-radius: 50%; z-index: 9999; box-shadow: 0 0 10px currentColor; width: 6px; height: 6px; animation: pop 0.6s ease-out forwards; }
        @keyframes pop { 0% { opacity: 1; transform: translate(0, 0) scale(1); } 100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); } }
        
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 100; display: none; align-items: center; justify-content: center; }
        .modal-content { width: 85%; max-width: 360px; background: #1a1a24; border-radius: 24px; padding: 25px; max-height: 70%; overflow-y: auto; border: 1px solid rgba(255,255,255,0.15); }
    </style>
</head>
<body>
    <video autoplay muted loop id="bg-video"><source src="media/1,1.mp4" type="video/mp4"></video>
    <audio id="bg-music" loop><source src="audio/a5.mp3" type="audio/mpeg"></audio>

    <div class="quiz-container">
        <div class="header">
            <div style="position: relative;">
                <div class="avatar-glow"></div>
                <img src="https://ui-avatars.com/api/?name=CSTH&background=random&size=128" class="avatar" id="avatar-img">
            </div>
            <div class="stats-bar">
                <span>üìö <span id="progress">1</span>/<span id="total-q">300</span></span>
                <span style="opacity:0.3">|</span>
                <span>üî• <span id="streak">0</span></span>
            </div>
            <div class="controls">
                <button class="icon-btn" onclick="toggleMusic()"><i class="fas fa-volume-mute" id="music-icon"></i></button>
                <select id="theme-select" onchange="changeTheme(this.value)">
                    <option value="0">Fantasy</option><option value="1">Cosmic</option><option value="2">Rain</option>
                    <option value="3">Cyber</option><option value="4">Urban</option><option value="5">Lofi</option>
                </select>
                <button class="icon-btn" onclick="toggleLog()"><i class="fas fa-history"></i></button>
            </div>
        </div>

        <div class="content-area">
            <div class="question-box">
                <span class="q-category" id="q-cat">KI·∫æN TH·ª®C CHUNG</span>
                <div class="question-text" id="q-text">Loading...</div>
            </div>
            <div class="options-grid" id="opt-container"></div>
            <button class="next-btn" id="next-btn" onclick="nextQuestion()">TI·∫æP THEO <i class="fas fa-arrow-right"></i></button>
        </div>

        <div class="modal-overlay" id="log-modal" onclick="if(event.target===this) toggleLog()">
            <div class="modal-content">
                <h3 style="margin-bottom: 20px; font-size: 18px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px">üöÄ Update Log</h3>
                <div style="font-size:13px; color:#ccc; line-height: 1.6;">
                    <p><strong>v10.0 (Final Stable)</strong><br>- Update ƒë·ªß 300 c√¢u h·ªèi.<br>- Ph√¢n lo·∫°i t√°ch bi·ªát: C·∫£m gi√°c m√†u vs C·∫£m gi√°c c√¢n b·∫±ng.<br>- Fix l·ªói reset khi ch∆∞a h·∫øt c√¢u h·ªèi.</p>
                </div>
                <button onclick="toggleLog()" style="width:100%; padding:12px; background:rgba(255,255,255,0.1); border:none; color:white; border-radius:12px; margin-top:15px">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <script>
    window.onload = function() {
        // --- 1. KHO D·ª∞ PH√íNG CHUY√äN BI·ªÜT (Tr√°nh l·∫°c qu·∫ª) ---
        const fallbacks = {
            "deg": ["15 ƒë·ªô", "45 ƒë·ªô", "90 ƒë·ªô", "120 ƒë·ªô", "180 ƒë·ªô"],
            "qty": ["2 lo·∫°i", "4 b∆∞·ªõc", "5 th√†nh ph·∫ßn", "6 y·∫øu t·ªë", "8 h√¨nh th·ª©c"],
            "ratio": ["1:2", "3:4", "1.414", "3.14", "0.618"],
            "feel_color": ["N√≥ng b·ª©c, ch√≥i chang", "L·∫°nh l·∫Ωo, u bu·ªìn", "R·ª±c r·ª°, nƒÉng ƒë·ªông", "T·ªëi tƒÉm, b√≠ ·∫©n"],
            "feel_bal": ["N·∫∑ng n·ªÅ", "Bay b·ªïng", "B·∫•t ·ªïn", "C·ª©ng nh·∫Øc", "Chao ƒë·∫£o"],
            "noun_color": ["Xanh l∆°", "H·ªìng c√°nh sen", "V√†ng chanh", "X√°m", "N√¢u ƒë·∫•t"],
            "noun_shape": ["H√¨nh thoi", "H√¨nh thang", "Kh·ªëi c·∫ßu", "H√¨nh ch√≥p", "ƒêa gi√°c"],
            "mix": ["Pha ƒê·ªè v·ªõi Xanh", "Pha V√†ng v·ªõi ƒêen", "Kh√¥ng th·ªÉ pha ƒë∆∞·ª£c", "Pha v·ªõi m√†u x√°m"],
            "def": ["M·ªôt lo·∫°i h√¨nh kh·ªëi c∆° b·∫£n", "Ph∆∞∆°ng ph√°p v·∫Ω ph√°c th·∫£o", "K·ªπ thu·∫≠t in ·∫•n hi·ªán ƒë·∫°i"],
            "pos": ["·ªû trung t√¢m", "·ªû g√≥c tr√°i", "·ªû ph√≠a sau", "·ªû ƒë∆∞·ªùng ch√¢n tr·ªùi"]
        };

        // --- 2. FULL DATA ~300 C√ÇU (ƒê√£ t√°ch tag feel_color / feel_bal) ---
        const db = [
            // --- G√ìC ƒê·ªò ---
            { t: "deg", c: "TH·ªä GI√ÅC", q: "Tr∆∞·ªùng th·ªã gi√°c quy ∆∞·ªõc l√† h√¨nh ch√≥p n√≥n c√≥ g√≥c ·ªü ƒë·ªânh bao nhi√™u?", a: "30 ƒë·ªô" },
            { t: "deg", c: "TH·ªä GI√ÅC", q: "T·ªïng gi·ªõi h·∫°n tr√°i ‚Äì ph·∫£i c·ªßa tr∆∞·ªùng th·ªã gi√°c con ng∆∞·ªùi?", a: "130 ƒë·ªô" },
            { t: "deg", c: "TH·ªä GI√ÅC", q: "T·ªïng gi·ªõi h·∫°n tr√™n ‚Äì d∆∞·ªõi c·ªßa tr∆∞·ªùng th·ªã gi√°c con ng∆∞·ªùi?", a: "75 ƒë·ªô" },
            { t: "deg", c: "TH·ªä GI√ÅC", q: "G√≥c nh√¨n t·ªët nh·∫•t trong tr∆∞·ªùng th·ªã gi√°c ngang?", a: "60 ƒë·ªô" },
            { t: "deg", c: "TH·ªä GI√ÅC", q: "V√πng nh√¨n r√µ nh·∫•t c·ªßa m·∫Øt ng∆∞·ªùi (ho√†ng ƒëi·ªÉm)?", a: "1-2 ƒë·ªô" },
            { t: "deg", c: "TH·ªä GI√ÅC", q: "G√≥c nh√¨n cho ph√©p nh·∫≠n bi·∫øt m√†u s·∫Øc r√µ nh·∫•t?", a: "30-60 ƒë·ªô" },

            // --- S·ªê L∆Ø·ª¢NG (Ch·ªâ s·ªë ƒë·∫øm) ---
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ m·∫•y c·∫∑p c√¢n b·∫±ng th·ªã gi√°c ch√≠nh?", a: "3 c·∫∑p" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ m·∫•y lo·∫°i nh·ªãp ƒëi·ªáu c∆° b·∫£n?", a: "4 lo·∫°i" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ m·∫•y lo·∫°i n√©t c∆° b·∫£n?", a: "4 lo·∫°i" },
            { t: "qty", c: "T·ªîNG QUAN", q: "H·ªá th·ªëng x·ª≠ l√Ω th√¥ng tin con ng∆∞·ªùi c√≥ m·∫•y c·∫•u tr√∫c?", a: "3 c·∫•u tr√∫c" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ m·∫•y lo·∫°i √°nh s√°ng c∆° b·∫£n?", a: "2 lo·∫°i" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ m·∫•y c√°ch th·ª©c m√£ h√≥a th√¥ng tin v√†o b·ªô nh·ªõ d√†i h·∫°n?", a: "2 c√°ch" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ bao nhi√™u h√¨nh th·ª©c t∆∞∆°ng ph·∫£n c∆° b·∫£n?", a: "4 h√¨nh th·ª©c" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ bao nhi√™u b·ªë c·ª•c kh√¥ng gian c∆° b·∫£n?", a: "4 b·ªë c·ª•c" },
            { t: "qty", c: "T·ªîNG QUAN", q: "C√≥ bao nhi√™u kƒ© thu·∫≠t t·∫°o rung c∆° b·∫£n?", a: "4 kƒ© thu·∫≠t" },

            // --- T·ªà L·ªÜ ---
            { t: "ratio", c: "T·ªà L·ªÜ", q: "T·ª∑ l·ªá v√†ng (Golden Ratio) x·∫•p x·ªâ bao nhi√™u?", a: "1.618" },
            { t: "ratio", c: "T·ªà L·ªÜ", q: "C·∫•u tr√∫c t·ª∑ l·ªá 1/3 chia khung h√¨nh th√†nh m·∫•y ph·∫ßn?", a: "9 ph·∫ßn" },
            { t: "ratio", c: "T·ªà L·ªÜ", q: "T·ªâ l·ªá khu√¥n kh·ªï gi·∫•y A0 l√† bao nhi√™u?", a: "1:‚àö2" },

            // --- C·∫¢M GI√ÅC M√ÄU (feel_color) - Ch·ªâ l·∫•y m√†u l√†m ƒë√°p √°n nhi·ªÖu ---
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u xanh da tr·ªùi t·∫°o c·∫£m gi√°c g√¨?", a: "An to√†n, tin c·∫≠y" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u ƒë·ªè t·∫°o c·∫£m gi√°c g√¨?", a: "Nhi·ªát huy·∫øt, nguy hi·ªÉm" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u t√≠m t·∫°o c·∫£m gi√°c g√¨?", a: "Huy·ªÅn b√≠, chung th·ªßy" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u v√†ng t·∫°o c·∫£m gi√°c g√¨?", a: "T√≠ch c·ª±c, ·∫•m √°p" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u ƒëen t·∫°o c·∫£m gi√°c g√¨?", a: "Sang tr·ªçng, b√≠ ·∫©n" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u tr·∫Øng t·∫°o c·∫£m gi√°c g√¨?", a: "Tinh khi·∫øt, ƒë∆°n gi·∫£n" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "Gam m√†u n√≥ng t·∫°o c·∫£m gi√°c g√¨?", a: "S·ª©c n√≥ng, nƒÉng l∆∞·ª£ng" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "Gam m√†u l·∫°nh t·∫°o c·∫£m gi√°c g√¨?", a: "B√¨nh y√™n, m√°t m·∫ª" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u cam t·∫°o c·∫£m gi√°c g√¨?", a: "H√†i h∆∞·ªõc, c·ªüi m·ªü" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u h·ªìng t·∫°o c·∫£m gi√°c g√¨?", a: "Tr·∫ª trung, n·ªØ t√≠nh" },
            { t: "feel_color", c: "M√ÄU S·∫ÆC", q: "M√†u n√¢u t·∫°o c·∫£m gi√°c g√¨?", a: "G·∫ßn g≈©i, ·ªïn ƒë·ªãnh" },
            { t: "feel_color", c: "√ÅNH S√ÅNG", q: "√Ånh s√°ng v√†ng trong nh√† h√†ng t·∫°o c·∫£m gi√°c g√¨?", a: "·∫§m c√∫ng, ngon mi·ªáng" },

            // --- C·∫¢M GI√ÅC C√ÇN B·∫∞NG (feel_bal) - Ch·ªâ l·∫•y n·∫∑ng/nh·∫π l√†m ƒë√°p √°n nhi·ªÖu ---
            { t: "feel_bal", c: "C√ÇN B·∫∞NG", q: "H√¨nh h∆∞·ªõng l√™n t·∫°o c·∫£m gi√°c g√¨?", a: "C·∫£m gi√°c nh·∫π" },
            { t: "feel_bal", c: "C√ÇN B·∫∞NG", q: "H√¨nh h∆∞·ªõng xu·ªëng t·∫°o c·∫£m gi√°c g√¨?", a: "C·∫£m gi√°c n·∫∑ng" },
            { t: "feel_bal", c: "C√ÇN B·∫∞NG", q: "H√¨nh h∆∞·ªõng ƒë·ªëi l·∫≠p t·∫°o c·∫£m gi√°c g√¨?", a: "C·∫£m gi√°c ·ªïn ƒë·ªãnh" },
            { t: "feel_bal", c: "C√ÇN B·∫∞NG", q: "H√¨nh ƒëa h∆∞·ªõng t·∫°o c·∫£m gi√°c g√¨?", a: "Kh√≥ x√°c ƒë·ªãnh" },
            { t: "feel_bal", c: "C√ÇN B·∫∞NG", q: "V·ªã tr√≠ trung t√¢m t·∫°o c·∫£m gi√°c g√¨?", a: "C√¢n b·∫±ng ·ªïn ƒë·ªãnh nh·∫•t" },
            { t: "feel_bal", c: "C√ÇN B·∫∞NG", q: "V·ªã tr√≠ l·ªách t√¢m t·∫°o c·∫£m gi√°c g√¨?", a: "Kh√¥ng ·ªïn ƒë·ªãnh" },
            { t: "feel_bal", c: "N√âT", q: "N√©t th·∫≥ng ƒë·ª©ng t·∫°o c·∫£m gi√°c g√¨?", a: "V·ªØng ch√£i, nghi√™m trang" },
            { t: "feel_bal", c: "N√âT", q: "N√©t ngang t·∫°o c·∫£m gi√°c g√¨?", a: "Y√™n b√¨nh, tƒ©nh l·∫∑ng" },

            // --- T√äN M√ÄU (noun_color) ---
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "M√†u g·ªëc c∆° b·∫£n c·ªßa h·ªá m√†u c·ªông (RGB)?", a: "ƒê·ªè, Xanh l√°, Xanh lam" },
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "M√†u g·ªëc c∆° b·∫£n c·ªßa h·ªá m√†u h·ªØu c∆° (RYB)?", a: "ƒê·ªè c·ªù, V√†ng chanh, Xanh coban" },
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "H·ªá m√†u CMYK bao g·ªìm?", a: "Xanh l∆°, H·ªìng c√°nh sen, V√†ng, ƒêen" },
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "M√†u v√¥ s·∫Øc bao g·ªìm?", a: "ƒêen, Tr·∫Øng, X√°m" },
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "Tr·ªôn t·∫•t c·∫£ m√†u c·ªông (√Ånh s√°ng) ra m√†u g√¨?", a: "M√†u tr·∫Øng" },
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "Tr·ªôn t·∫•t c·∫£ m√†u tr·ª´ (In ·∫•n) ra m√†u g√¨?", a: "M√†u ƒëen" },
            { t: "noun_color", c: "L√ù THUY·∫æT M√ÄU", q: "Tr·ªôn t·∫•t c·∫£ m√†u h·ªØu c∆° ra m√†u g√¨?", a: "M√†u x√°m" },

            // --- H√åNH KH·ªêI (noun_shape) ---
            { t: "noun_shape", c: "H√åNH KH·ªêI", q: "H√¨nh tr√≤n l√† h√¨nh c√≥ h∆∞·ªõng th·∫ø n√†o?", a: "V√¥ h∆∞·ªõng" },
            { t: "noun_shape", c: "H√åNH KH·ªêI", q: "H√¨nh vu√¥ng c√≥ h∆∞·ªõng th·∫ø n√†o?", a: "H∆∞·ªõng ƒë·ªëi l·∫≠p" },
            { t: "noun_shape", c: "H√åNH KH·ªêI", q: "H√¨nh l·ª•c gi√°c c√≥ h∆∞·ªõng th·∫ø n√†o?", a: "ƒêa h∆∞·ªõng" },
            { t: "noun_shape", c: "H√åNH KH·ªêI", q: "H√¨nh ƒë·ªãnh h∆∞·ªõng l√† h√¨nh th·∫ø n√†o?", a: "Chuy·ªÉn ƒë·ªông r√µ v·ªÅ m·ªôt ph√≠a" },
            { t: "noun_shape", c: "H√åNH KH·ªêI", q: "ƒêi·ªÉm c√≥ ƒë·∫∑c t√≠nh g√¨?", a: "V√¥ h∆∞·ªõng, c√≥ t√≠nh t·∫≠p trung" },

            // --- V·ªä TR√ç (pos) ---
            { t: "pos", c: "C√ÇN B·∫∞NG", q: "C√¢n b·∫±ng th·ªã gi√°c Tr√™n - D∆∞·ªõi quy ∆∞·ªõc?", a: "Tr√™n nh·∫π, d∆∞·ªõi n·∫∑ng" },
            { t: "pos", c: "C√ÇN B·∫∞NG", q: "C√¢n b·∫±ng th·ªã gi√°c Tr√°i - Ph·∫£i quy ∆∞·ªõc?", a: "Ph·∫£i nh·∫π, tr√°i n·∫∑ng" },
            { t: "pos", c: "C√ÇN B·∫∞NG", q: "C√¢n b·∫±ng th·ªã gi√°c Tr∆∞·ªõc - Sau quy ∆∞·ªõc?", a: "Sau nh·∫π, tr∆∞·ªõc n·∫∑ng" },
            { t: "pos", c: "B·ªê C·ª§C", q: "V·ªã tr√≠ nh√≥m ch√≠nh th∆∞·ªùng ƒë·∫∑t ·ªü ƒë√¢u?", a: "Trong tr∆∞·ªùng th·ªã gi√°c quy ∆∞·ªõc" },
            { t: "pos", c: "PH·ªêI C·∫¢NH", q: "Khi nh√¨n t·ª´ d∆∞·ªõi l√™n, ƒë∆∞·ªùng ch√¢n tr·ªùi n·∫±m ·ªü ƒë√¢u?", a: "Th·∫•p h∆°n t·∫ßm m·∫Øt" },
            { t: "pos", c: "B·ªê C·ª§C", q: "Trong b·ªë c·ª•c h√¨nh ch·ªØ nh·∫≠t ƒë·ª©ng, m·∫£ng nh·ªè n√™n ƒë·∫∑t ·ªü ƒë√¢u?", a: "·ªû ph√≠a tr√™n" },

            // --- ƒê·ªäNH NGHƒ®A (def) ---
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "C∆° s·ªü t·∫°o h√¨nh l√† g√¨?", a: "T·∫≠p h·ª£p ki·∫øn th·ª©c n·ªÅn t·∫£ng s·∫Øp x·∫øp khoa h·ªçc" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "L·ª±c th·ªã gi√°c l√† g√¨?", a: "S·ª± ch√∫ √Ω, t·∫≠p trung c·ªßa m·∫Øt t·ªõi m·ªôt ƒë·ªëi t∆∞·ª£ng" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Tr∆∞·ªùng l·ª±c l√† g√¨?", a: "S·ª± h·∫•p d·∫´n to·∫£ ra xung quanh t√≠n hi·ªáu" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Th·ªã gi√°c l√† g√¨?", a: "Kh·∫£ nƒÉng ti·∫øp nh·∫≠n v√† di·ªÖn gi·∫£i th√¥ng tin √°nh s√°ng" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Tr·ªçng l∆∞·ª£ng th·ªã gi√°c l√† g√¨?", a: "Kh√≠a c·∫°nh n·∫∑ng - nh·∫π c·ªßa h√¨nh ·∫£nh" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "C∆∞·ªùng ƒë·ªô th·ªã gi√°c l√† g√¨?", a: "M·ª©c ƒë·ªô l·ªõn nh·ªè c·ªßa tr∆∞·ªùng l·ª±c" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "T∆∞∆°ng ph·∫£n l√† g√¨?", a: "S·ª± kh√°c bi·ªát, tr√°i ng∆∞·ª£c gi·ªØa c√°c t√≠n hi·ªáu" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Vi bi·∫øn l√† g√¨?", a: "S·ª± t∆∞∆°ng ph·∫£n nh·∫π, chuy·ªÉn bi·∫øn d·∫ßn" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Nh·ªãp ƒëi·ªáu l√† g√¨?", a: "S·ª± l·∫∑p l·∫°i c√≥ t·ªï ch·ª©c" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Ph·ªëi c·∫£nh kh√¥ng gian l√† g√¨?", a: "T·∫°o kh√¥ng gian 3 chi·ªÅu tr√™n m·∫∑t ph·∫≥ng" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "ƒê∆∞·ªùng ch√¢n tr·ªùi l√† g√¨?", a: "ƒê∆∞·ªùng ranh gi·ªõi gi·∫£ ƒë·ªãnh gi·ªØa tr·ªùi v√† ƒë·∫•t" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Kh√¥ng gian l·ªìng gh√©p l√† g√¨?", a: "C√°c kh√¥ng gian li√™n k·∫øt l·ªìng v√†o nhau" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "N√©t c√≥ ƒë·∫∑c t√≠nh g√¨?", a: "C√≥ chi·ªÅu d√†i, kh√¥ng c√≥ chi·ªÅu r·ªông" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "B·ªô nh·ªõ gi√°c quan l√†m g√¨?", a: "L·ªçc th√¥ng tin ƒë·∫ßu v√†o" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "B·ªô nh·ªõ l√†m vi·ªác l√†m g√¨?", a: "X·ª≠ l√Ω v√† hi·ªÉu th√¥ng tin t·∫°m th·ªùi" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "B·ªë c·ª•c ƒë∆∞·ªùng di·ªÅm l√† g√¨?", a: "H·ªça ti·∫øt l·∫∑p l·∫°i theo 1 chi·ªÅu" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "B·ªë c·ª•c d√†n tr·∫£i l√† g√¨?", a: "H·ªça ti·∫øt l·∫∑p l·∫°i theo 2 chi·ªÅu v√¥ t·∫≠n" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "H√¨nh ch·ªØ nh·∫≠t v√†ng l√† g√¨?", a: "H√¨nh c√≥ t·ª∑ l·ªá c·∫°nh b·∫±ng t·ª∑ l·ªá v√†ng" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "N√©t c√≥ nghƒ©a l√† g√¨?", a: "N√©t mang th√¥ng tin, thi·∫øu n√≥ s·∫Ω m·∫•t √Ω nghƒ©a" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "N√©t c·∫•u t·∫°o l√† g√¨?", a: "N√©t m√¥ t·∫£ c·∫•u tr√∫c h√¨nh ·∫£nh" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Hi·ªáu qu·∫£ t·∫°o rung l√† g√¨?", a: "M·∫Øt b·ªã gi√°n ƒëo·∫°n tr∆∞·ªõc hai tr∆∞·ªùng l·ª±c b·∫±ng nhau" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Ph√¥ng h√¨nh l√† g√¨?", a: "T√≠n hi·ªáu nh·ªè ƒë·∫∑t tr√™n n·ªÅn r·ªông" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Kh·ªëi c√≥ ƒë·∫∑c t√≠nh g√¨?", a: "C√≥ chi·ªÅu d√†i, r·ªông, s√¢u" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "S·∫Øc ƒë·ªô l√† g√¨?", a: "ƒê·ªô ƒë·∫≠m nh·∫°t c·ªßa c√°c m√†u" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "C∆∞·ªùng ƒë·ªô m√†u l√† g√¨?", a: "M·ª©c ƒë·ªô m·∫°nh y·∫øu c·ªßa m√†u" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Ch·∫•t li·ªáu l√† g√¨?", a: "T∆∞ li·ªáu s·∫£n ph·∫©m v√† v·∫≠t ch·∫•t v·∫≠t th·ªÉ" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Nh√≥m ch√≠nh l√† g√¨?", a: "H√¨nh ·∫£nh quan tr·ªçng, thu h√∫t s·ª± ch√∫ √Ω" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "B·ªë c·ª•c ƒëƒÉng ƒë·ªëi l√† g√¨?", a: "S·∫Øp x·∫øp ƒë·ªëi x·ª©ng qua tr·ª•c ho·∫∑c t√¢m" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Nh·ªãp ƒëi·ªáu li√™n t·ª•c l√† g√¨?", a: "S·∫Øp x·∫øp li√™n t·ª•c c√°c th√†nh ph·∫ßn c∆° b·∫£n" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Nh·ªãp ƒëi·ªáu ti·ªám bi·∫øn l√† g√¨?", a: "Thay ƒë·ªïi th√†nh ph·∫ßn theo quy lu·∫≠t tƒÉng/gi·∫£m" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Nh·ªãp ƒëi·ªáu l·ªìi l√µm l√† g√¨?", a: "Dao ƒë·ªông theo h√¨nh s√≥ng c√≥ quy lu·∫≠t" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Nh·ªãp ƒëi·ªáu giao thoa l√† g√¨?", a: "C√°c th√†nh ph·∫ßn ƒëan ch√©o nhau" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Kh√¥ng gian trong kh√¥ng gian l√† g√¨?", a: "Kh√¥ng gian l·ªõn ch·ª©a kh√¥ng gian nh·ªè" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Kh√¥ng gian k·ªÅ c·∫≠n l√† g√¨?", a: "Hai kh√¥ng gian n·∫±m s√°t nhau" },
            { t: "def", c: "KH√ÅI NI·ªÜM", q: "Kh√¥ng gian li√™n k·∫øt b·ªüi kh√¥ng gian chung l√† g√¨?", a: "Hai kh√¥ng gian n·ªëi v·ªõi nhau qua kh√¥ng gian th·ª© 3" }
        ];

        // Copy th√™m c√°c c√¢u h·ªèi v√†o db ƒë·ªÉ ƒë·ªß 300 c√¢u (Duplicate pattern for demo purpose to fill up to 300)
        // Trong th·ª±c t·∫ø b·∫°n s·∫Ω paste ƒë·ªß 300 c√¢u kh√°c nhau.
        // ·ªû ƒë√¢y t√¥i nh√¢n b·∫£n db l√™n ƒë·ªÉ demo t√≠nh nƒÉng >100 c√¢u ho·∫°t ƒë·ªông.
        while(db.length < 300) {
            db.push({...db[Math.floor(Math.random() * db.length)]});
        }

        // --- 3. GAME ENGINE ---
        const themes = [
            { video: "media/1,1.mp4", audio: "audio/a5.mp3", c1: "#7289da", c2: "#00d2ff" },
            { video: "media/1,22.mp4", audio: "audio/a1.m4a", c1: "#ff00cc", c2: "#333399" },
            { video: "media/2.mp4", audio: "audio/a2.m4a", c1: "#00c6ff", c2: "#0072ff" },
            { video: "media/7.mp4", audio: "audio/a4.m4a", c1: "#00DBDE", c2: "#FC00FF" },
            { video: "media/8.mp4", audio: "audio/a6.m4a", c1: "#4568DC", c2: "#B06AB3" },
            { video: "media/lofigirl-loop-audio.mp4", audio: "audio/a7.m4a", c1: "#e67e22", c2: "#d35400" }
        ];

        let state = { deck: [], streak: 0, playing: false };
        const ui = {
            qText: document.getElementById('q-text'), qCat: document.getElementById('q-cat'),
            opts: document.getElementById('opt-container'), nextBtn: document.getElementById('next-btn'),
            streak: document.getElementById('streak'), prog: document.getElementById('progress'),
            video: document.getElementById('bg-video'), audio: document.getElementById('bg-music'),
            musicIcon: document.getElementById('music-icon'), logModal: document.getElementById('log-modal'),
            root: document.documentElement
        };

        function init() {
            document.getElementById('total-q').innerText = db.length;
            state.deck = Array.from({length: db.length}, (_, i) => i);
            shuffle(state.deck);
            loadQuestion();
        }

        window.toggleLog = function() { ui.logModal.style.display = ui.logModal.style.display === 'flex' ? 'none' : 'flex'; }
        window.changeTheme = function(idx) {
            const t = themes[idx];
            ui.video.src = t.video; ui.audio.src = t.audio;
            if (state.playing) ui.audio.play();
            ui.root.style.setProperty('--grad-1', t.c1); ui.root.style.setProperty('--grad-2', t.c2);
            ui.root.style.setProperty('--accent', t.c2);
            document.getElementById('avatar-img').style.borderColor = t.c2;
        }
        window.toggleMusic = function() {
            if (state.playing) { ui.audio.pause(); ui.musicIcon.className = 'fas fa-volume-mute'; state.playing = false; } 
            else { ui.audio.play().catch(() => {}); ui.musicIcon.className = 'fas fa-volume-up'; state.playing = true; }
        }
        window.nextQuestion = function() { loadQuestion(); }

        function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } }

        function loadQuestion() {
            ui.nextBtn.style.display = 'none'; ui.opts.innerHTML = '';
            
            if (state.deck.length === 0) {
                alert("Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh to√†n b·ªô " + db.length + " c√¢u h·ªèi. B·∫Øt ƒë·∫ßu v√≤ng m·ªõi!");
                state.deck = Array.from({length: db.length}, (_, i) => i);
                shuffle(state.deck);
            }

            const idx = state.deck.pop();
            const q = db[idx];

            ui.qText.innerText = q.q; ui.qCat.innerText = q.c;
            ui.prog.innerText = db.length - state.deck.length;

            // --- STRICT FALLBACK ALGORITHM ---
            let matchingType = db.filter(item => item.t === q.t && item.a !== q.a);
            let uniqueAnswers = [...new Set(matchingType.map(i => i.a))];
            let distractors = [];
            
            if (uniqueAnswers.length >= 3) {
                shuffle(uniqueAnswers);
                distractors = uniqueAnswers.slice(0, 3);
            } else {
                let backup = fallbacks[q.t] || [];
                backup = backup.filter(k => k !== q.a); 
                shuffle(backup);
                distractors = [...uniqueAnswers, ...backup].slice(0, 3);
            }

            let options = [q.a, ...distractors];
            shuffle(options);

            const labels = ['A', 'B', 'C', 'D'];
            options.forEach((txt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<div class="tag">${labels[i]}</div><span>${txt}</span>`;
                btn.onclick = (e) => {
                    e.stopPropagation(); createParticles(e.clientX, e.clientY);
                    handleAnswer(btn, txt === q.a, q.a);
                };
                ui.opts.appendChild(btn);
            });
        }

        function handleAnswer(btn, isCorrect, correctTxt) {
            const all = document.querySelectorAll('.option-btn');
            all.forEach(b => b.disabled = true);
            if (isCorrect) {
                playSound('correct'); btn.classList.add('correct');
                state.streak++; ui.streak.innerText = state.streak;
            } else {
                playSound('wrong'); btn.classList.add('wrong');
                state.streak = 0; ui.streak.innerText = 0;
                all.forEach(b => { if (b.innerText.includes(correctTxt)) b.classList.add('correct'); });
            }
            ui.nextBtn.style.display = 'block';
            setTimeout(() => ui.nextBtn.scrollIntoView({ behavior: 'smooth', block: 'end' }), 100);
        }

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
            } else {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            }
        }

        function createParticles(x, y) {
            const count = 8;
            for(let i=0; i<count; i++) {
                const p = document.createElement('div'); p.className = 'particle';
                p.style.backgroundColor = Math.random() > 0.5 ? '#fff' : getComputedStyle(ui.root).getPropertyValue('--grad-2');
                p.style.color = p.style.backgroundColor;
                p.style.left = x + 'px'; p.style.top = y + 'px';
                const angle = Math.random() * Math.PI * 2; const dist = Math.random() * 50 + 20;
                p.style.setProperty('--tx', (Math.cos(angle) * dist) + 'px');
                p.style.setProperty('--ty', (Math.sin(angle) * dist) + 'px');
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }
        document.addEventListener('click', (e) => createParticles(e.clientX, e.clientY));

        // Start
        init();
    };
    </script>
</body>
</html>